### 操作系统

#### 一、进程间通信方式

- 管道（匿名和命名）
  - 匿名管道( pipe )：管道是一种半双工的通信方式，数据只能单向流动，而且只能在具有亲缘关系的进程间使用。进程的亲缘关系通常是指父子进程关系。
  - 有名管道 (named pipe) ： 有名管道也是半双工的通信方式，但是它允许无亲缘关系进程间的通信。
- 消息队列
- 共享内存
- 信号量
- 信号
- 套接字

#### 二、内核空间和用户空间

操作系统采用的是虚拟地址空间，以32位操作系统举例，它的寻址空间为4G(2的32次方)，这里解释二个概念:

1. 寻址: 是指操作系统能找到的地址范围，32位指的是地址总线的位数，你就想象32位的二进制数，每一位可以是0，可以是1，是不是有2的32次方种可能，2^32次方就是可以访问到的最大内存空间，也就是4G。
2. 虚拟地址空间：为什么叫虚拟，因为我们内存一共就4G，但操作系统为每一个进程都分配了4G的内存空间，这个内存空间实际是虚拟的，虚拟内存到真实内存有个映射关系。例如X86 cpu采用的段页式地址映射模型。

操作系统将这4G可访问的内存空间分为二部分，**一部分是内核空间，一部分是用户空间**。

内核空间是操作系统内核访问的区域，独立于普通的应用程序，是受保护的内存空间。

以linux操作系统为例，将最高的1G字节（从虚拟地址0xC0000000到0xFFFFFFFF），供内核使用，称为内核空间，而将较低的3G字节（从虚拟地址0x00000000到0xBFFFFFFF），供各个进程使用，称为用户空间。

每个进程可以通过系统调用进入内核，因此，Linux内核由系统内的所有进程共享。

**当进程/线程运行在内核空间时就处于内核态，而进程/线程运行在用户空间时则处于用户态。**

#### 三 、分段机制和分页机制

- 什么是分段机制

　　 分段机制就是把虚拟地址空间中的虚拟内存组织成一些长度可变的称为段的内存块单元。

-  什么是分页机制

　　 分页机制在段机制之后进行的，它进一步将线性地址转换为物理地址。

#### 四、IO多路复用

- **select**

  select 函数监视的文件描述符分3类，分别是writefds、readfds、和exceptfds。调用后select函数会阻塞，直到有描述符就绪（有数据 可读、可写、或者有except），或者超时（timeout指定等待时间，如果立即返回设为null即可），函数返回。

  - **select的一个缺点在于单个进程能够监视的文件描述符的数量存在最大限制**，在Linux上一般为1024.
  - **对socket进行扫描时是线性扫描，即采用轮询的方法，效率较低。**
  - **需要维护一个用来存放大量fd的数据结构，这样会使得用户空间和内核空间在传递该结构时复制开销大。**

- **poll**

  poll本质上和select没有区别，它将用户传入的数组拷贝到内核空间,然后查询每个fd对应的设备状态，如果设备就绪则在设备等待队列中加入一项并继续遍历，如果遍历完所有fd后没有发现就绪设备，则挂起当前进程，直到设备就绪或者主动超时，被唤醒后它又要再次遍历fd。这个过程经历了多次无谓的遍历。

  - **它没有最大连接数的限制，原因是它是基于链表来存储的**

  - **大量的fd的数组被整体复制于用户态和内核地址空间之间**

  - poll还有一个特点是“水平触发”，如果报告了fd后，没有被处理，那么下次poll时会再次报告该fd。

  - select和poll都需要在返回后，`通过遍历文件描述符来获取已经就绪的socket`。事实上，`同时连接的大量客户端在一时刻可能只有很少的处于就绪状态`，**因此随着监视的描述符数量的增长，其效率也会线性下降**

    

- **epoll**

  epoll是Linux所特有，epoll是在2.6内核中提出的，是之前的select和poll的增强版本。相对于select和poll来说，epoll更加灵活，没有描述符限制。`epoll使用一个文件描述符管理多个描述符，将用户关系的文件描述符的事件存放到内核的一个事件表中，这样在用户空间和内核空间的copy只需一次`。

  **基本原理**：`epoll支持水平触发和边缘触发，最大的特点在于边缘触发，它只告诉进程哪些fd刚刚变为就绪态，并且只会通知一次`。还有一个特点是，`epoll使用“事件”的就绪通知方式`，通过epoll_ctl注册fd，`一旦该fd就绪，内核就会采用类似callback的回调机制来激活该fd`，epoll_wait便可以收到通知。

  - **没有最大并发连接的限制**，能打开的FD的上限远大于1024
  - **效率提升，不是轮询的方式，不会随着FD数目的增加效率下降**，活跃可用的FD才会调用callback函数；`即Epoll最大的优点就在于它只管你“活跃”的连接，而跟连接总数无关`，因此在实际的网络环境中，Epoll的效率就会远远高于select和poll。
  - **内存拷贝**，利用mmap()文件映射内存加速与内核空间的消息传递；`即epoll使用mmap减少复制开销`。