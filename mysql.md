## mysql

### 一 基础

##### 1、ACID 原子性，持久性，一致性，隔离性

##### 2、事务存在问题

- 脏读
- 丢失修改
- 不可重复读
- 幻读

##### 3、隔离级别

- 读取未提交

- 读取已提交

- 可重复读 （innodb默认隔离级别）

  **MySQL InnoDB 的 REPEATABLE-READ（可重读）并不保证避免幻读，需要应用使用加锁读来保证。而这个加锁读使用到的机制就是 Next-Key Locks。**

- 可串行化

##### 4、日志

`MySQL` 日志 主要包括错误日志、查询日志、慢查询日志、事务日志、二进制日志几大类。其中，比较重要的还要属二进制日志 `binlog`（归档日志）和事务日志 `redo log`（重做日志）和 `undo log`（回滚日志）。

- **binlog**（归档日志）

  **数据备份、主备、主主、主从， 保证一致性**

  `binlog` 是逻辑日志，记录内容是语句的原始逻辑，类似于“给 ID=2 这一行的 c 字段加 1”，属于`MySQL Server` 层

- **redolog**（重做日志）

  **Innodb 独有，保证崩溃恢复，持久性**

  每条 redo 记录由“表空间号+数据页号+偏移量+修改数据长度+具体修改的数据”组成

  物理日志，记录内容是“在某个数据页上做了什么修改”，属于 `InnoDB` 存储引擎

- **undolog**（回滚日志）

  **事务回滚，保证原子性**

  mvcc 依赖

##### 5、MVCC

​	 `MVCC` 的实现依赖于：**隐藏字段、Read View、undo log**。在内部实现中，`InnoDB` 通过数据行的 `DB_TRX_ID` 和 `Read View` 来判断数据的可见性，如不可见，则通过数据行的 `DB_ROLL_PTR` 找到 `undo log` 中的历史版本。每个事务读到的数据版本可能是不一样的，在同一个事务中，用户只能看到该事务创建 `Read View` 之前已经提交的修改和该事务本身做的修改

##### 6、索引

- **B(B-)树和B+树的区别**

  - B 树的所有节点既存放键(key) 也存放 数据(data)，而 B+树只有叶子节点存放 key 和 data，其他内节点只存放 key。
  - B 树的叶子节点都是独立的;B+树的叶子节点有一条引用链指向与它相邻的叶子节点。
  - B 树的检索的过程相当于对范围内的每个节点的关键字做二分查找，可能还没有到达叶子节点，检索就结束了。而 B+树的检索效率就很稳定了，任何查找都是从根节点到叶子节点的过程，叶子节点的顺序检索很明显。

- **索引类型**

  - 主键索引

  - 二级索引（辅助索引）

    唯一索引，普通索引，前缀索引，全文索引

    **二级索引又称为辅助索引，是因为二级索引的叶子节点存储的数据是主键。也就是说，通过二级索引，可以定位主键的位置。**

- 聚簇索引

  **聚集索引即索引结构和数据一起存放的索引。主键索引属于聚集索引。**

- 非聚簇索引

  **非聚集索引即索引结构和数据分开存放的索引。**

##### 7、sql 执行流程

- 查询语句的执行流程如下：权限校验（如果命中缓存）--->查询缓存--->分析器--->优化器--->权限校验--->执行器--->引擎
- 更新语句执行流程如下：分析器---->权限校验---->执行器--->引擎---redo log(prepare 状态)--->binlog--->redo log(commit状态)

### 二、集群

#### 1、主从复制



